
# vim 解决问题的方式

理念：对重复性操作进行优化。vim通过记录最近的操作，让我们用一次按键就能重复上次的修改。

## 技巧1 . 命令

描述：. 命令可以让我们重复上次修改。

### 什么是修改？

> normal 模式下：上次修改是指一次使文本发生变化的修改操作，如x，dd；

> insert模式下：上次修改是指进入insert模式开始，直到返回普通模式（输入<Esc>）之间对文本进行的一段修改操作。

. 命令是一个微型的宏。

宏：Vim可以录制任意数目的按键操作，然后在以后重复执行它们。

. 范式：一次按键移动，一次按键修改。

## 技巧2 不要自我重复

用最少的命令完成重复的修改操作。

### vim命令之一箭双雕

- C 代替 c$
- S 代替 ^c
- I 代替 ^i
- A 代替 $a
- o 代替 A<CR>
- O 代替 ko

## 技巧3 以退为进

先退一步，再进三步，使修改具有可重复操作性。

vim命令之 "f{char}": 查找下一处指定字符{char}出现的位置，若找到直接把光标指定到那里。

vim命令之 ";": 重复查找上次 f 命令所查找的字符 

## 技巧4 执行、重复、回退

面对重复性工作时，我们需要让移动动作和修改都能够重复，从而达到一个最佳的编辑模式。

### Vim 的支持

- . 命令会重复上次修改；
- @: 重复任意Ex命令
- & 重复上次的 :substitute命令
- 使用回退命令，撤销修改
- ……

![](image/vim-repeat-rollback-table.png.jpg)

## 技巧5 查找并手动替换

: substitute 命令
> :s/content/copy/g

\* 命令：查找当前光标下的单词。

: substitute 命令的一种替代方法：命令“* + cwcopy<Esc> + n + .”的组合模式。

## 技巧6 结识 . 范式

一种理想的编辑模式：用一键移动，另一键执行。

# 模式-普通模式

## 技巧7 停顿时请移开画笔

## 技巧8 把撤销单元切成块

用好<Esc>键：将整体的修改操作切分成多次独立的一次性修改单元，以控制撤销的粒度。

目标：让每次撤销操作都刚好变成你想要的样子。

## 技巧9 构造可重复的修改

example：对下面文本，初始光标在字符“h”上，目标是删除单词“nigh”。
> The end is nigh

- 方法一：db + x，反向删除，使用 . 命令重复删除时（. == x）
- 方法二：b + dw，正向删除，使用 . 命令重复删除时（. == dw）
- 方法三：daw，文本对象删除，使用 . 命令重复删除时（. == daw）

比较：
- 按键数：打平手
- 重复性：方法三只使用一次 . 命令就可以重复删除一个单词，获胜。

启发：

**道**：养成一个使修改可重复的习惯。

**术**：充分利用 . 命令，构造可重复的修改命令。

## 技巧10 用次数做简单的算术运算

{number}<C-a> 命令：光标处数字加number，若光标处不是数字，自动向右找到当前行第一个数字并执行加法操作。

{number}<C-x> 命令：光标处数字减number，若光标处不是数字，自动向右找到当前行第一个数字并执行减法操作。

## 技巧11 能够重复，就别用次数

## 技巧12 双剑合璧，天下无敌

操作符 + 动作命令 = 操作

操作符待决模式

### 自定义操作符与已有动作命令协同工作

如：commentary 插件的 \\\ 注释操作符

### 自定义动作命令与已有操作符协同工作

如：textobj-entity 插件的 ae 选中整个文本命令

# 插入模式

## 技巧13 在插入模式中即可更正错误

| 按键操作 | 用途 |
| - | - |
| \<C-h> | 删除前一个字符（同退格键）|
| \<C-w> | 删除前一个单词 |
| \<C-u> | 删除至行首 |

## 技巧14 返回普通模式

使用其它命令代替<Esc>命令，如 <C-[>， \<C-o>， \<C-c>。

\<C-o> 命令：插入-普通模式来回切换。**妙用**：当我们处于插入模式时，想运行一个普通模式命令，然后马上回到原来的位置继续输入。

zz命令：重绘屏幕，把当前行显示在窗口正中，以便阅读。

\<C-o>zz 组合使用。

## 技巧15 不离开插入模式，粘贴寄存器中的文本

\<C-r>{register} : 插入模式下，将寄存器{register}中的文本粘贴到光标所在位置。

## 技巧16 随时随地做运算

使用表达式寄存器做一些运算，并把运算结果直接插入到文档中。
用法详情在技巧70. 

## 技巧17 用字符编码插入非常用字符

| 按键操作 | 用途 |
| - | - |
| \<C-v>{123} |以十进制字符编码插入字符 |
| \<C-v>{1234} | 以十六进制字符编码插入字符 |
| \<C-v>{nondigit} | 按原义插入非数字字符 |
| \<C-k>{char1}{char2} | 插入以二合字母{char1}{char2}表示的字符|

使用 ga 查看当前光标下的字符编码

## 技巧18 用二合字母插入非常用字符

使用二合字母来代替数字编码，更容易记住和输入。

> 用命令 :digraphs 可查看可用的二合字母列表。

> 用命令 :h digraph-table 查看另一个更有用的列表。

## 技巧19 用替换模式替换已有文本

> R : 由普通模式进入替换模式，每次替换文件中的单个字符，如制表符。

> gR : 由普通模式进入虚拟替换模式，每次替换文件在屏幕中实际显示的单个字符，如制表符会分为8个空格字符来替换。


# 可视模式

## 技巧20 深入理解可视模式

## 技巧21 选择高亮选区

普通模式进入可视模式

| 按键操作 | 用途 |
| - | - |
| v | 进入面向字符的可视模式 |
| V | 进入面向行的可视模式 |
| \<C-v> | 进入面向块的可视模式 |

高亮区域：进入可视模式后，选择的高亮区域的范围是通过其两个端点界定的。

| 按键操作 | 用途 |
| gv | 重新选择上次的高亮区域 |
| o | 切换高亮选区的活动端 |

## 技巧22 重复执行面向行的可视命令

## 技巧23 只要可能，最好用操作符命令，而不是可视命令

例子：标签包含的内容大写。

```html
<a href="#">one</a>
<a href="#">two</a>
<a href="#">three</a>
```

> vit + U : 先选中元素再转换为大写，但使用 “.” 重复性差；  
> gU + it : 先用操作符待决命令再执行选中的文本对象，可使用“.”重复操作。（推荐）

操作符命令的缺点：可能要操作的文本范围的结构很难用动作命令表达出来，这时可视模式会比较好。

## 技巧24 用面向列块的可视模式编辑表格数据

## 技巧25 修改列文本

## 技巧26 在长短不一的高亮块后添加文本

# 命令行模式

## 技巧27 结识 Vim 的命令行模式

## 技巧28 在一行或多个连续行上执行命令

## 技巧29 使用‘:t’ 和 ‘:m’ 命令复制和移动行

## 技巧30 在指定范围上执行普通模式命令

## 技巧31 重复上次的 Ex 命令

## 技巧32 自动补全 Ex 命令

## 技巧33 把当前单词插入到命令行

## 技巧34 回溯历史命令

## 技巧35 运行 Shell 命令

---
第四部分 寄存器

# 复制与粘贴

Vim 术语对照表

(cut, copy, paste) -> Vim (delete, yank, put)  

## 技巧59 用无名寄存器实现删除、复制与粘贴操作

操作 无名寄存器，  
xp 组合命令：调换光标之后的两个字符。  
ddp 组合命令：调换两行文本的顺序。  

## 技巧60 深入理解 Vim 寄存器

Vim 的复制、删除、粘贴等操作命令会将当前选中的文本复制到 无名寄存器 中去。  
可以通过给命令加 "{register}" 前缀的方式指定要用的寄存器，如 "ayiw" 将当前单词复制到寄存器a中。  

Vim 内置的寄存器：

| 寄存器类别 | 符号 | 说明 |
| - | - | - |
| 无名寄存器 | "" |
| 复制专用寄存器 | "0 |
| 有名寄存器 | "a - "z | 
| 黑洞寄存器 | "_ | 删除的文本不会覆盖无名寄存器 |
| 系统剪贴板 | "+ | 等效于外部程序的系统剪贴板 |
| 选择专用寄存器 | "* | 主剪贴板，windows下等同于 "+ |
| 表达式寄存器 | "= |

有名寄存器的小写字母引用若换成大写字母的话，则会将新内容添加到该寄存器的原有内容之后。

只读寄存器：
 
| 寄存器  |   内容 |
| -- | -- |
| "%   |      当前文件名 |
| "#   |      轮换文件名 |
| ".   |      上次插入的文本 |
| ":   |      上次执行的 Ex 命令 |
| "/   |      上次查找的模式 |

## 技巧61 用寄存器中的内容替换高亮选区的文本

m{char} : 设置标记
`{char} : 跳转到该标记

## 技巧62 把寄存器的内容粘贴出来

插入模式下，可使用 \<C-r>{register} 来插入指定 {register} 中的值，注意插入模式下的 {register} 中的第一个字符 " 可以省略。

粘贴面向行的区域。gp 粘贴行后会把光标的位置移到被粘贴出来的文本结尾而不是开头。

## 技巧63 与系统剪贴板进行交互

插入模式下使用 \<C-v> 来粘贴系统剪贴板的内容，但可能不生效，依系统而定。

使用系统剪贴板寄存器 "+ 。

# 宏

宏可以把任意数目的按键操作录制到寄存器中，用于之后的回放。

## 技巧64 宏的读取与执行

### 把命令序列录制成宏

q 键：既是宏的录制按钮，也是宏的停止按钮。  
录制开始：使用 q{register} ，指定一个用于保存宏的寄存器。
录制结束：q，中间的每一条命令将会被宏捕获。

例：
```
var foo = l;
var bar = 'a';
var foobar = foo + bar;
```

### 通过执行宏来回放命令序列

使用 @a 回放宏，使用 @@ 回放上次使用的宏。

使用 {number}@a 来执行 number 次宏。 

## 技巧65 规范光标位置、直达目标以及终止宏

黄金法则：在录制一个宏时，要确保每条命令都可以被重复执行。

1. 规范光标的位置。使命中正确的目标会变得更容易。
2. 用可重复的动作命令直达目标。使用查找命令或文本对象定位，从而使你的宏兼具灵活性与可重复性。
3. 录制宏的过程中，禁止使用鼠标。
4. 当动作命令失败时，宏将被终止执行。可以利用这个特性放心大胆的重复宏，而不用顾忌执行的次数。（前提：宏本身隐含了一种内置的安全捕获机制）

## 技巧66 加次数回放宏

通过宏可以使 . 命令能执行指定次数。

~ : 大小写转换。

## 技巧67 在连续的文本行上重复修改

### 串行、并行执行宏

:normal @a  并行执行宏。

22@a  串行执行宏。

如何抉择？  
并行：更健壮。
串行：更容易定位问题。

